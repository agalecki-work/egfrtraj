% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/subset_egfrtibble.R
\name{subset_egfrtibble}
\alias{subset_egfrtibble}
\title{Subset an egfrtibble object by subject IDs}
\usage{
subset_egfrtibble(x, ids = NULL)
}
\arguments{
\item{x}{An object of class \code{"egfrtibble"}}

\item{ids}{Character vector of subject IDs to keep.
If \code{NULL} (default), only the first subject in the object is selected.}
}
\value{
An \code{"egfrtibble"} object (possibly empty) with updated
\code{origdata_info$final_subjects} attribute:
\itemize{
\item \code{"one"}    if exactly 1 subject remains
\item \code{"subset"} if 1 < n_subjects < original n_subjects_final
\item \code{"All"}    if all original subjects are kept (rare)
\item \code{"empty"}  if no subjects remain
}
}
\description{
Creates a subset of an \code{"egfrtibble"} object containing only the specified
subject IDs. If \code{ids = NULL}, selects only the first subject present in the
object. Invalid/missing IDs are silently skipped. The \code{final_subjects}
attribute is updated accordingly.

If the resulting subset is empty, returns an empty tibble of class
\code{"egfrtibble"} with updated metadata (and a warning).
}
\examples{
\dontrun{
# First create a full egfrtibble object
res <- extract_egfrtibble(example_egfr_data)

# Get all unique IDs from the original data
all_ids <- unique(example_egfr_data$id)


# ── 1. Subset to subjects with specific true_pattern (using original data) ───
# Note: true_pattern is not kept in res → we use the original data frame
selected_ids <- example_egfr_data |>
  dplyr::filter(true_pattern \%in\% c("linear", "with_breakpoint")) |>
  dplyr::distinct(id) |>
  dplyr::pull(id)

print(selected_ids)   # show which IDs were selected

sub <- subset_egfrtibble(res, ids = selected_ids)

nrow(sub)                              # number of rows in subset
n_distinct(sub$id)                     # number of subjects kept
attr(sub, "origdata_info")$final_subjects   # usually "subset"


# ── 2. Select only the first subject (ids = NULL) ────────────────────────────
sub_first <- subset_egfrtibble(res)

n_distinct(sub_first$id)               # should be 1
attr(sub_first, "origdata_info")$final_subjects   # "one"
sub_first$id[1]                        # which subject was chosen


# ── 3. Request IDs that don't exist (silently skipped) ───────────────────────
bad_ids <- c("nonexistent1", "nonexistent2", selected_ids[3])
sub_bad <- subset_egfrtibble(res, ids = bad_ids)

n_distinct(sub_bad$id)                 # only 1 subject kept
attr(sub_bad, "origdata_info")$final_subjects   # "one"


# ── 4. Empty subset (no matching IDs) ────────────────────────────────────────
sub_empty <- subset_egfrtibble(res, ids = c("9999", "ZZZ"))

nrow(sub_empty)                        # 0 rows
n_distinct(sub_empty$id)               # 0 subjects
attr(sub_empty, "origdata_info")$final_subjects   # "empty"
# Note: warning is shown when result is empty


# ── 5. Chain with other operations ───────────────────────────────────────────
# Keep only one subject and prepare for single-case analysis
one_sub <- subset_egfrtibble(res, ids = selected_ids[1])


# ── Invalid usage examples (will stop with error) ────────────────────────────
# \dontrun{
#   subset_egfrtibble(example_egfr_data)          # not an egfrtibble → error
#   subset_egfrtibble(res, ids = 123)             # non-character ids → error
# }
}
}
